<?xml version="1.0" encoding="UTF-8" ?>
<odoo>
    <template
        id="portal_my_survey_answers_contacts"
        inherit_id="survey_portal.portal_my_survey_answers"
        name="My Survey Answers"
    >
        <xpath expr="//th[@id='th-create-date']" position="after">
            <th id="th-contacts">Contacts</th>
        </xpath>
        <xpath expr="//td[@id='td-create-date']" position="after">
            <td id="td-contacts">
                <t t-set="contact_count" t-value="len(answer.contact_ids)" />
                <t t-set="current_count" t-value="0" />
                <t
                    t-foreach="answer.contact_ids.sorted(key=lambda x: x.name)"
                    t-as="contact"
                >
                    <t t-set="current_count" t-value="current_count +1" />
                    <span
                        t-field="contact.name"
                        data-toggle="tooltip"
                        t-att-title="contact.name"
                    /><t t-if="contact_count - current_count != 0">, <br /></t>
                </t>
            </td>
        </xpath>
        <xpath expr="//a[@id='button-review-answer']" position="before">
            <form
                id="survey_contacts"
                t-att-action="'/survey/contacts/%s/%s' % (answer.survey_id.access_token, answer.access_token)"
                method="post"
                itemscope="itemscope"
                itemprop="offers"
                itemtype="http://schema.org/AggregateOffer"
            >
                <input
                    type="hidden"
                    name="csrf_token"
                    t-att-value="request.csrf_token()"
                />
                <button
                    id="button-add-contacts"
                    type="submit"
                    class="btn btn-link a-submit float-right no-decoration o_wait_lazy_js"
                    role="button"
                    title="Add Contacts"
                    aria-label="Add Contacts"
                >Add Contacts</button>
            </form>
        </xpath>
    </template>
    <template
        id="portal_answer_page_contact_ids"
        name="Survey Answer Portal Template"
        inherit_id="survey_portal.portal_answer_page"
    >
        <xpath expr="//li[@id='sidebar_partner']" position="after">
            <li
                id="sidebar_contact"
                t-if="answer.contact_ids"
                class="list-group-item flex-grow-1"
            >
                <div class="small mb-1"><strong
                        class="text-muted"
                    >Contacts</strong></div>
                <t t-foreach="answer.contact_ids" t-as="contact">
                    <div class="row">
                        <div class="col flex-grow-0 pr-2">
                            <img
                                t-if="contact.image_1024"
                                class="rounded-circle mt-1 o_portal_contact_img"
                                t-att-src="image_data_uri(contact.image_1024)"
                                alt="Contact"
                            />
                            <img
                                t-else=""
                                class="rounded-circle mt-1 o_portal_contact_img"
                                src="/web/static/src/img/user_menu_avatar.png"
                                alt="Contact"
                            />
                        </div>
                        <div class="col pl-0">
                            <span
                                t-esc="contact"
                                t-options='{"widget": "contact", "fields": ["name", "phone"], "no_marker": True}'
                            />
                        </div>
                    </div>
                </t>
            </li>
        </xpath>
        <xpath expr="//li[@id='sidebar_partner']" position="attributes">
            <attribute name="t-if">1==0</attribute>
        </xpath>
        <xpath
            expr="//ul[@id='survey_portal_sidebar_list']//div[hasclass('o_download_pdf')]"
            position="inside"
        >
            <div class="btn-group flex-grow-1 mr-1 mb-1">
                <form
                    id="survey_contacts"
                    t-att-action="'/survey/contacts/%s/%s' % (answer.survey_id.access_token, answer.access_token)"
                    method="post"
                    itemscope="itemscope"
                    itemprop="offers"
                    itemtype="http://schema.org/AggregateOffer"
                    class="w-100"
                >
                    <input
                        type="hidden"
                        name="csrf_token"
                        t-att-value="request.csrf_token()"
                    />
                    <button
                        id="button-add-contacts"
                        type="submit"
                        class="btn btn-secondary btn-block o_add_contact_btn a-submit o_wait_lazy_js"
                        role="button"
                        title="Add Contacts"
                        aria-label="Add Contacts"
                    ><i class="fa fa-address-book" /> Add Contacts</button>
                </form>
            </div>
            <div class="btn-group flex-grow-1 mr-1 mb-1">
                <button
                    id="button-show-invites"
                    type="button"
                    class="btn btn-secondary btn-block"
                    role="button"
                    title="Show invites"
                    aria-label="Show invites"
                    data-toggle="modal"
                    data-target="#modal_survey_contact_invites"
                ><i class="fa fa-envelope" /> Show invites</button>
            </div>
        </xpath>
        <xpath expr="//body" position="inside">
            <t t-call="survey_contact_ids.survey_contact_invites_modal" />
        </xpath>
    </template>
</odoo>
