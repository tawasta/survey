<?xml version="1.0" encoding="UTF-8" ?>
<odoo>
    <!-- ADD SURVEY ATTACHMENTS MODAL -->
    <template name="Survey Attachments" id="survey_attachments_modal">
        <div
            id="modal_survey_attachments"
            class="modal fade"
            tabindex="-1"
            role="dialog"
        >
            <div class="modal-dialog modal-lg" role="document">
                <form
                    id="survey-attachments-form"
                    class="mt32 js_website_submit_form"
                    t-att-action="'/survey/attachments/%s/%s/post' % (survey_token, answer_token)"
                    method="post"
                    enctype="multipart/form-data"
                >
                    <input
                        type="hidden"
                        name="csrf_token"
                        t-att-value="request.csrf_token(time_limit=False)"
                    />
                    <input type="hidden" name="answer_id" t-att-value="answer.id" />
                    <div class="modal-content">
                        <div class="modal-header align-items-center">
                            <h4 class="modal-title">Upload Attachments</h4>
                            <button
                                type="button"
                                class="close close-modal"
                                aria-label="Close"
                            >
                                <span>×</span>
                            </button>
                        </div>
                        <div class="modal-body bg-light border-bottom">
                            <div class="panel panel-primary">
                                <div class="panel-heading">
                                    <h3 class="panel-title">Upload Attachments</h3>
                                </div>
                                <div class="panel-body">
                                    <p class="alert alert-warning alert-dismissable"><a
                                            href="#"
                                            class="close"
                                            data-dismiss="alert"
                                            aria-label="close"
                                        >×</a>
                                        Please upload additional attachments for this survey answer.
                                    </p>
                                        <t
                                        t-foreach="survey.question_and_page_ids"
                                        t-as="question"
                                    >
                                            <t
                                            t-if="not question.is_page and question in answer.predefined_question_ids"
                                            t-call="survey_portal_upload_attachments.portal_question_container"
                                        />
                                        </t>
                                </div>
                            </div>
                        </div>
                        <div class="modal-body bg-light border-bottom">
                            <p class="alert alert-info alert-dismissable">
                                <a
                                    href="#"
                                    class="close"
                                    data-dismiss="alert"
                                    aria-label="close"
                                >×</a>
                                <i class="fa fa-info-circle" />
                                <span>By clicking <strong
                                    >"Upload Attachments"</strong> the additional files will be saved for this survey answer.</span>
                            </p>
                        </div>
                        <div class="modal-footer border-0 justify-content-between">
                            <button
                                type="button"
                                class="btn btn-secondary close-modal js_goto_event"
                            >Cancel</button>
                            <button
                                type="submit"
                                id="contact-submit-button"
                                class="btn btn-primary submit-contact"
                                data-toggle="tooltip"
                                data-position="top"
                                title="By clicking &quot;Upload Attachments&quot; the additional files will be saved for this survey answer."
                            >Upload Attachments</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </template>
    <template id="portal_question_container" name="Survey: portal question container">
        <t
            t-set="answer_lines"
            t-value="answer.user_input_line_ids.filtered(lambda line: line.question_id == question)"
        />
        <t t-if="question.question_type == 'attachment'">
            <div class="row">
                <div class="col-lg my-2">
                    <input
                        type="file"
                        t-att-name="question.id"
                        t-att-data-name="question.id"
                        t-att-id="'file_name_%d' % question.id"
                        t-att-data-question-type="question.question_type"
                        t-att-validation-size-max="question.validation_max_attachment_filesize"
                        t-att-multiple="None if not question.is_multiple_attachments else 'multiple'"
                        t-att-accept="None if not question.validation_attachment_file_type else ('application/pdf' if question.validation_attachment_file_type == 'pdf' else ('image/*' if question.validation_attachment_file_type == 'image' else None))"
                        class="form_control portal_question_attachment bg_transparent text-dark rounded-0 p-0"
                    />
                    <t t-foreach="answer_lines.value_attachment_ids" t-as="file">
                        <div class="o_survey_attachment_answer" t-att-id="file.id">
                            <a
                                t-att-href="file.link_url"
                                aria-label="Download"
                                title="Download"
                                target="_blank"
                            >
                                <i class="fa fa-download" />
                                <span>
                                    <t t-esc="file.name" />
                                </span>
                            </a>
                        </div>
                    </t>
                </div>
            </div>
        </t>
    </template>

</odoo>
